# Cloudflare Worker: Image Processor
# Deploy with: npm install && wrangler deploy

name = "lunari-image-processor"
main = "index.ts"
compatibility_date = "2024-01-01"

# Enable nodejs_compat for better module support
compatibility_flags = ["nodejs_compat"]

# R2 Bucket binding (same bucket as gallery-upload)
[[r2_buckets]]
binding = "GALLERY_BUCKET"
bucket_name = "lunari-previews"

# Environment variables (non-secret)
[vars]
B2_PUBLIC_URL = "https://f005.backblazeb2.com/file/lunari-gallery"
CDN_URL = "https://cdn.lunarihub.com"

# Secrets (configure via wrangler secret put):
# wrangler secret put SUPABASE_URL
# wrangler secret put SUPABASE_SERVICE_ROLE_KEY
# wrangler secret put WORKER_AUTH_SECRET
